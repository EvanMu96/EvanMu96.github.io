<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>[LeetCode] 数组的区间信息类型题目 | Komoriii</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="之前在知乎上看到有算法竞赛经历的同学曾经提到过「线段树」「树状数组」这两种特殊的树型数据结构, 后来19年找工作前在leetcode上联系发现每次遇到维护区间信息的题目的时候有可以用到这几种数据结构,因此随手记两道典型的题目用于备忘. 线段树: 307. Range Sum Query - Mutable题目描述给定一个整数数组  nums，求出数组从索引 i 到 j  (i ≤ j) 范围内元素">
<meta property="og:type" content="article">
<meta property="og:title" content="[LeetCode] 数组的区间信息类型题目">
<meta property="og:url" content="http://blog.senevan.com/2020/03/25/2020-03-25/index.html">
<meta property="og:site_name" content="Komoriii">
<meta property="og:description" content="之前在知乎上看到有算法竞赛经历的同学曾经提到过「线段树」「树状数组」这两种特殊的树型数据结构, 后来19年找工作前在leetcode上联系发现每次遇到维护区间信息的题目的时候有可以用到这几种数据结构,因此随手记两道典型的题目用于备忘. 线段树: 307. Range Sum Query - Mutable题目描述给定一个整数数组  nums，求出数组从索引 i 到 j  (i ≤ j) 范围内元素">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://blog.senevan.com/images/segmenttreedemo.png">
<meta property="og:image" content="https://oi-wiki.org/ds/images/fenwick1.png">
<meta property="og:image" content="https://docs.google.com/drawings/d/e/2PACX-1vTZ0_26anaHr0gYiob9nPq8ylkHPN_tE3jsPGVFB-wPWz8Hvek8P_AHW7plaQFe501xo1VeIrhZLN1t/pub?w=960&amp;h=720">
<meta property="article:published_time" content="2020-03-24T16:22:56.000Z">
<meta property="article:modified_time" content="2021-03-02T09:32:01.824Z">
<meta property="article:author" content="Komoriii">
<meta property="article:tag" content="LeetCode">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://blog.senevan.com/images/segmenttreedemo.png">
  
    <link rel="alternate" href="/atom.xml" title="Komoriii" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Komoriii</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/About-Me">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.senevan.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-2020-03-25" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/03/25/2020-03-25/" class="article-date">
  <time class="dt-published" datetime="2020-03-24T16:22:56.000Z" itemprop="datePublished">2020-03-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      [LeetCode] 数组的区间信息类型题目
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>之前在知乎上看到有算法竞赛经历的同学曾经提到过「线段树」「树状数组」这两种特殊的树型数据结构, 后来19年找工作前在leetcode上联系发现每次遇到维护区间信息的题目的时候有可以用到这几种数据结构,因此随手记两道典型的题目用于备忘.</p>
<h2 id="线段树-307-Range-Sum-Query-Mutable"><a href="#线段树-307-Range-Sum-Query-Mutable" class="headerlink" title="线段树: 307. Range Sum Query - Mutable"></a>线段树: 307. Range Sum Query - Mutable</h2><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>给定一个整数数组  nums，求出数组从索引 i 到 j  (i ≤ j) 范围内元素的总和，包含 i,  j 两点。</p>
<p>update(i, val) 函数可以通过将下标为 i 的数值更新为 val，从而对数列进行修改。</p>
<p>示例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Given nums &#x3D; [1, 3, 5]</span><br><span class="line"></span><br><span class="line">sumRange(0, 2) -&gt; 9</span><br><span class="line">update(1, 2)</span><br><span class="line">sumRange(0, 2) -&gt; 8</span><br></pre></td></tr></table></figure>
<p>说明:</p>
<p>数组仅可以在 update 函数下进行修改。<br>你可以假设 update 函数与 sumRange 函数的调用次数是均匀分布的。</p>
<p>来源：力扣（LeetCode）<br>链接：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/range-sum-query-mutable">https://leetcode-cn.com/problems/range-sum-query-mutable</a><br>著作权归领扣网络所有。商业转载请联系官方授权，非商业转载请注明出处。</p>
<h3 id="设计思路"><a href="#设计思路" class="headerlink" title="设计思路"></a>设计思路</h3><p>线段树也是一种二叉搜索树。线段树有一个特点是，只有leaf节点是实在的元素，而其余的节点都表示多个元素的和。线段树使用的场景也是用来存储可以做区间加法的元素，并且需要大量地计算某个区间的和，而不是取具体某个节点的值「因为需要直接取值干脆就用vector了，可以O(1)随机存取」。下图是一个非常简单的线段树的例子，蓝色节点表示是多个节点的和，橙色的节点表示的是叶节点，与题目中的num相对应。</p>
<p>线段树相比于一般的二叉搜索树的游戏在于，在查询一个区间的和的时候有着O（logN）的时间复杂度。</p>
<p><img src="/images/segmenttreedemo.png" alt="segmenttreedemo"></p>
<p>构建一棵线段树可以从任意一个空或非空的数组/向量开始，后续可以使用update(i, val)方法修改index为i的叶节点的值为val「我们由于在线段树中删除和添加的操作，实际的语义都是添加一个线段/删除一个线段，并且涉及到在查询的时候查询的区间可能并不构成一个线段，比如查询0<del>10但是实际是0</del>5和8~10两个线段，所以对于添加和删除暂且不做深入」。</p>
<p>回归到LeetCode 307这一道题目，下面我给出的代码大致上参考了花花的LeetCode307教程[2]。我个人非常推荐在找工作的同学去看花花的Youtube频道或者他个人网站上的思路讲解, 我对于DP的入门就是来自他的视频讲解.</p>
<details>
  <summary>点击查看代码</summary>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">// 一种特殊的二叉搜索树 线段树</span></span><br><span class="line"><span class="comment">// 线段树的树叶节点是真实插入的元素 其余的节点都表示一个区间和</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SegmentTreeNode</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    SegmentTreeNode(<span class="keyword">int</span> start, <span class="keyword">int</span> end, <span class="keyword">int</span> sum = <span class="number">0</span>, SegmentTreeNode* left = <span class="literal">nullptr</span>,</span><br><span class="line">                                                 SegmentTreeNode* right = <span class="literal">nullptr</span>):</span><br><span class="line">        start(start), end(end), sum(sum), left(left), right(right) &#123;&#125;</span><br><span class="line">    SegmentTreeNode(<span class="keyword">const</span> SegmentTreeNode&amp;) = <span class="keyword">delete</span>; <span class="comment">// disable copy construction</span></span><br><span class="line">    SegmentTreeNode&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> SegmentTreeNode&amp;) = <span class="keyword">delete</span>; <span class="comment">// disable asssignment</span></span><br><span class="line">    ~SegmentTreeNode() &#123;</span><br><span class="line">        <span class="keyword">delete</span> left;</span><br><span class="line">        <span class="keyword">delete</span> right;</span><br><span class="line">        left = right = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> start; <span class="comment">// start of index</span></span><br><span class="line">    <span class="keyword">int</span> end; <span class="comment">// end of index (included)</span></span><br><span class="line">    <span class="keyword">int</span> sum; <span class="comment">// sum of the range</span></span><br><span class="line">    SegmentTreeNode* left; <span class="comment">// left subTree</span></span><br><span class="line">    SegmentTreeNode* right; <span class="comment">// right subTree</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NumArray</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    NumArray(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums) &#123;</span><br><span class="line">        nums_.swap(nums);</span><br><span class="line">        <span class="keyword">if</span>(!nums_.empty()) root_.reset(buildTree(<span class="number">0</span>, nums_.size() - <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        updateTree(root_.get(), i, val);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sumRange</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sumRange(root_.get(), i, j);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; nums_;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;SegmentTreeNode&gt; root_;</span><br><span class="line">    <span class="comment">// initialize a SegmentTree</span></span><br><span class="line">    <span class="function">SegmentTreeNode* <span class="title">buildTree</span><span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(start == end) <span class="comment">// only 1 element, this is a leaf node</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Build a leaf: &quot;</span> &lt;&lt; nums_[start] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SegmentTreeNode(start, end, nums_[start]);</span><br><span class="line">        &#125;</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">int</span> mid = start + (end - start) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">auto</span> left = buildTree(start, mid);</span><br><span class="line">        <span class="keyword">auto</span> right = buildTree(mid + <span class="number">1</span>, end);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Build a non-leaf, the sum is:&quot;</span> &lt;&lt; left-&gt;sum + right-&gt;sum &lt;&lt; <span class="built_in">endl</span>; </span><br><span class="line">        <span class="keyword">auto</span> node = <span class="keyword">new</span> SegmentTreeNode(start, end, left-&gt;sum + right-&gt;sum, left, right);</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateTree</span><span class="params">(SegmentTreeNode* root, <span class="keyword">int</span> i, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root-&gt;start == i &amp;&amp; root-&gt;end == i) &#123;</span><br><span class="line">            root-&gt;sum = val;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> mid = root-&gt;start + (root-&gt;end - root-&gt;start) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(i &lt;= mid) &#123;</span><br><span class="line">            updateTree(root-&gt;left, i, val);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> updateTree(root-&gt;right, i, val);</span><br><span class="line">    </span><br><span class="line">        root-&gt;sum = root-&gt;left-&gt;sum + root-&gt;right-&gt;sum;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sumRange</span><span class="params">(SegmentTreeNode* root, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(i == root-&gt;start &amp;&amp; j == root-&gt;end) <span class="keyword">return</span> root-&gt;sum;</span><br><span class="line">        <span class="comment">//cout &lt;&lt; root-&gt;sum &lt;&lt; &quot; &quot;;</span></span><br><span class="line">        <span class="keyword">int</span> mid = root-&gt;start + (root-&gt;end - root-&gt;start) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(j &lt;= mid) &#123;</span><br><span class="line">            <span class="keyword">return</span> sumRange(root-&gt;left, i, j);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(i &gt; mid) &#123;</span><br><span class="line">            <span class="keyword">return</span> sumRange(root-&gt;right, i, j);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> sumRange(root-&gt;left, i, mid) + sumRange(root-&gt;right, mid + <span class="number">1</span>, j);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; v = &#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>&#125;;</span><br><span class="line">    <span class="function">NumArray <span class="title">n</span><span class="params">(v)</span></span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; n.sumRange(<span class="number">0</span>, <span class="number">2</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    n.update(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; n.sumRange(<span class="number">0</span>, <span class="number">2</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</details>

<h2 id="493-翻转对-Reverse-Pairs"><a href="#493-翻转对-Reverse-Pairs" class="headerlink" title="493. 翻转对 Reverse Pairs"></a>493. 翻转对 Reverse Pairs</h2><h3 id="题目描述-1"><a href="#题目描述-1" class="headerlink" title="题目描述"></a>题目描述</h3><p>给定一个数组 nums ，如果 i &lt; j 且 nums[i] &gt; 2*nums[j] 我们就将 (i, j) 称作一个重要翻转对。</p>
<p>你需要返回给定数组中的重要翻转对的数量。</p>
<p>示例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">输入: [1,3,2,3,1]</span><br><span class="line">输出: 2</span><br><span class="line"></span><br><span class="line">输入: [2,4,3,5,1]</span><br><span class="line">输出: 3</span><br><span class="line"></span><br><span class="line">注意:</span><br><span class="line">给定数组的长度不会超过50000。</span><br><span class="line">输入数组中的所有数字都在32位整数的表示范围内</span><br></pre></td></tr></table></figure>


<p>来源：力扣（LeetCode）<br>链接：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/reverse-pairs">https://leetcode-cn.com/problems/reverse-pairs</a><br>著作权归领扣网络所有。商业转载请联系官方授权，非商业转载请注明出处。</p>
<h3 id="设计思路-1"><a href="#设计思路-1" class="headerlink" title="设计思路"></a>设计思路</h3><p>题目要找到所有的在序列中位置靠前但是比靠后的元素大两倍的pair.<br>首先需要介绍树状数组Fenwick Tree.<br>树状数组也是用来维护区间信息的, 但是树状数组要比线段树易于实现很多.它的思路也是用一个大节点表示一些元素的信息,进行查询的时候只要对大节点进行查询就可以减少对树底层元素的访问次数.<br>下图来自OI Wiki<br><img src="https://oi-wiki.org/ds/images/fenwick1.png" alt="oiwiki"><br>八个实边的方框的方块是存入树状数组的8个数,对应到最上层的连续内存块<code>nums</code>(小表从1开始), 他们上面参差不齐的生涯的方块就代表树状数组的区间信息大节点<code>cn</code>. 显然可以看出与<code>c2</code>关联的是<code>nums[1] + num[2]</code>,与<code>c6</code>关联的是<code>nums[5] + nums[6]</code>, 而<code>c8</code>维护着全局的区间信息.<br>有了树状数组,我们可以查询[1,val]之间的整数数量, 对于nums[i]而言, 我们先查询[1, 2*nums[i]]之间的整数数量, 再求出[1, maxvalue]之间的数量, 二者相减就是以i为右端点的翻转对的数量.</p>
<details>
  <summary>点击查看代码</summary>
​```C++
class BIT
{
private:
    vector<int> tree;
    int n;
public:
    BIT(int n): n(n), tree(n+1){}
    static constexpr int lowbit(int x) {return x & (-x);}
    void update(int x, int d)
    {
        while(x <= n)
        {
            tree[x] += d;
            x += lowbit(x);
        }
    }

<pre><code>int query(int x) const 
&#123;
    int ans = 0;
    while(x)
    &#123;
        ans += tree[x];
        x -= lowbit(x);
    &#125;
    return ans;
&#125;
</code></pre>
<p>};</p>
<p>class Solution {<br>public:<br>    int reversePairs(vector<int>&amp; nums) {<br>        set<long long> allNUmbers;<br>        for(int x: nums)<br>        {<br>            allNUmbers.insert(x);<br>            allNUmbers.insert((long long)x*2);<br>        }<br>        // 利用哈希表进行离散化<br>        unordered_map&lt;long long, int&gt; values;<br>        int idx = 0;<br>        for(long long x:allNUmbers) values[x] = ++idx;</p>
<pre><code>    int ret = 0;
    BIT bit(values.size());
    for(int i =0; i &lt; nums.size(); i++)
    &#123;
        int left = values[(long long)nums[i] * 2], right = values.size();
        ret += bit.query(right) - bit.query(left);
        bit.update(values[nums[i]], 1);
    &#125;
    return ret;
&#125;
</code></pre>
<p>};</p>
<p>void trimLeftTrailingSpaces(string &amp;input) {<br>    input.erase(input.begin(), find_if(input.begin(), input.end(), [](int ch) {<br>        return !isspace(ch);<br>    }));<br>}</p>
<p>void trimRightTrailingSpaces(string &amp;input) {<br>    input.erase(find_if(input.rbegin(), input.rend(), [](int ch) {<br>        return !isspace(ch);<br>    }).base(), input.end());<br>}</p>
<p>vector<int> stringToIntegerVector(string input) {<br>    vector<int> output;<br>    trimLeftTrailingSpaces(input);<br>    trimRightTrailingSpaces(input);<br>    input = input.substr(1, input.length() - 2);<br>    stringstream ss;<br>    ss.str(input);<br>    string item;<br>    char delim = ‘,’;<br>    while (getline(ss, item, delim)) {<br>        output.push_back(stoi(item));<br>    }<br>    return output;<br>}</p>
<p>int main() {<br>    string line;<br>    while (getline(cin, line)) {<br>        vector<int> nums = stringToIntegerVector(line);</p>
<pre><code>    int ret = Solution().reversePairs(nums);

    string out = to_string(ret);
    cout &lt;&lt; out &lt;&lt; endl;
&#125;
return 0;
</code></pre>
<p>}</p>
<p>```</p>
</details>
## 区间类题目的其他解法
对于这类区间信息维护的题即便了解上面两种数据结构其实也是可以做的, 方法是通过归并(或者更直接说是写一个归并排序)的同时自底向上计算区间信息, 然后对区间信息做加减法, 不过这种方法也仅仅比暴力每次计算区间信息要好一些而已, 如果要追求更高效的算法还是免不了要了解几种树.
<img src="https://docs.google.com/drawings/d/e/2PACX-1vTZ0_26anaHr0gYiob9nPq8ylkHPN_tE3jsPGVFB-wPWz8Hvek8P_AHW7plaQFe501xo1VeIrhZLN1t/pub?w=960&amp;h=720">

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>[1]<a target="_blank" rel="noopener" href="https://blog.csdn.net/zearot/article/details/52280189">https://blog.csdn.net/zearot/article/details/52280189</a><br>[2]<a target="_blank" rel="noopener" href="https://zxi.mytechroad.com/blog/data-structure/307-range-sum-query-mutable/">https://zxi.mytechroad.com/blog/data-structure/307-range-sum-query-mutable/</a><br>[3]<a target="_blank" rel="noopener" href="https://oi-wiki.org/ds/fenwick/">https://oi-wiki.org/ds/fenwick/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.senevan.com/2020/03/25/2020-03-25/" data-id="cklrtbiju000i42ou6ymbhowd" data-title="[LeetCode] 数组的区间信息类型题目" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LeetCode/" rel="tag">LeetCode</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/08/16/2020-08-16/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          [最近的日常]成为了游戏服务器程序员
        
      </div>
    </a>
  
  
    <a href="/2020/03/05/2020-03-05/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">[LeetCode] 994.腐烂的橘子</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Anime/" rel="tag">Anime</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Backup/" rel="tag">Backup</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C-STL/" rel="tag">C++, STL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C-vcpkg-Notes/" rel="tag">C++, vcpkg, Notes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CPython-VM/" rel="tag">CPython, VM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LeetCode/" rel="tag">LeetCode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Leetcode/" rel="tag">Leetcode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Life/" rel="tag">Life</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Notes/" rel="tag">Notes</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Anime/" style="font-size: 10px;">Anime</a> <a href="/tags/Backup/" style="font-size: 10px;">Backup</a> <a href="/tags/C-STL/" style="font-size: 10px;">C++, STL</a> <a href="/tags/C-vcpkg-Notes/" style="font-size: 10px;">C++, vcpkg, Notes</a> <a href="/tags/CPython-VM/" style="font-size: 10px;">CPython, VM</a> <a href="/tags/LeetCode/" style="font-size: 10px;">LeetCode</a> <a href="/tags/Leetcode/" style="font-size: 15px;">Leetcode</a> <a href="/tags/Life/" style="font-size: 20px;">Life</a> <a href="/tags/Notes/" style="font-size: 20px;">Notes</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/02/26/2021-02-26/">[开发环境]切换到vcpkg</a>
          </li>
        
          <li>
            <a href="/2021/02/23/2021-02-23/">[编程随记]CPython 中的小整数池的实现</a>
          </li>
        
          <li>
            <a href="/2021/02/02/2021-02-02/">[C++]实现std::move和std::forward</a>
          </li>
        
          <li>
            <a href="/2021/01/05/2021-01-02/">[南来北往]京沪卧铺动车乘坐体验</a>
          </li>
        
          <li>
            <a href="/2021/01/05/2020-01-01/">[最近的日常]2020年末装机杂记</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 Komoriii<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/About-Me" class="mobile-nav-link">About</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>